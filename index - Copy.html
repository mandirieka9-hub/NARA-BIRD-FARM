<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Burung</title>

  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet" />

  <style>
    /* ====== CSS ASLI KAMU (TIDAK DIUBAH) ====== */
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-color: #f4f4f4;
      display: flex;
      min-height: 100vh;
      color: #fff;
      transition: background 0.3s ease-in-out;
    }

    .sidebar {
      width: 240px;
      background: rgba(44, 62, 80, 0.85);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.4);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-logo img {
      width: 110px;
      height: 110px;
      object-fit: contain;
      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
    }

    .sidebar-name {
      margin-top: 10px;
      font-weight: 600;
      text-align: center;
    }

    .sidebar-desc {
      font-size: 13px;
      text-align: center;
      margin-top: 5px;
    }

    .sidebar-links {
      margin-top: 25px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: center;
    }

    .link-item a {
      color: #fff;
      font-size: 26px;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }

    .content {
      flex: 1;
      padding: 20px;
    }

    .data-section {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(6px);
      border-radius: 12px;
      padding: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    input {
      width: 60%;
      padding: 8px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: #fff;
    }

    .popup {
      position: fixed;
      inset: 0;
      display: none;
      background: rgba(0,0,0,0.6);
      align-items: center;
      justify-content: center;
    }

    .popup-content {
      background: rgba(255,255,255,0.15);
      padding: 25px;
      border-radius: 18px;
      width: 90%;
      max-width: 420px;
    }
  </style>
</head>

<body>

<div class="sidebar">
  <div class="sidebar-logo"><img id="logoImg" src="" alt="Logo"></div>
  <div class="sidebar-name" id="siteName">Nama Situs</div>
  <div class="sidebar-desc" id="siteDesc"></div>

  <div class="sidebar-links">
    <div class="link-item">
      <a id="whatsappLink" href="#" target="_blank"><i class="ri-whatsapp-fill"></i></a>
    </div>
    <div class="link-item">
      <a id="mapsLink" href="#" target="_blank"><i class="ri-map-pin-2-fill"></i></a>
    </div>
  </div>
</div>

<div class="content">
  <div class="data-section">
    <h2>Data Burung</h2>
    <input id="searchInput" placeholder="Cari No Ring atau Jenis...">

    <table id="birdTable">
      <thead>
        <tr>
          <th>No Ring</th>
          <th>Jenis</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div class="popup" id="birdPopup">
  <div class="popup-content">
    <h3 id="popupRing"></h3>
    <p><b>Jenis:</b> <span id="popupJenis"></span></p>
    <p><b>Gender:</b> <span id="popupGender"></span></p>
    <p><b>Tgl Lahir:</b> <span id="popupTgl"></span></p>
    <p><b>Indukan Jantan:</b> <span id="popupJantan"></span></p>
    <p><b>Indukan Betina:</b> <span id="popupBetina"></span></p>
    <button id="closePopup">Tutup</button>
  </div>
</div>
<style>
/* ==========================
   RESPONSIVE MOBILE FIX
   ========================== */
@media (max-width: 768px) {

  body {
    font-size: 14px;
  }

  header {
    padding: 12px;
    text-align: center;
  }

  header img {
    max-width: 80px;
    height: auto;
  }

  .container {
    flex-direction: column;
    padding: 10px;
  }

  .sidebar {
    width: 100% !important;
    margin-bottom: 10px;
  }

  .data-section {
    width: 100% !important;
    padding: 10px;
  }

  .search-box input {
    width: 100%;
    font-size: 16px;
    padding: 10px;
  }

  table {
    width: 100%;
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }

  table th,
  table td {
    font-size: 13px;
    padding: 8px;
  }

  .icon-button {
    min-width: 44px;
    min-height: 44px;
  }

  .footer {
    font-size: 12px;
    padding: 10px;
    text-align: center;
  }
}
</style>

<script>
/* ===============================
   KONFIGURASI
================================ */
const API_URL = "https://script.google.com/macros/s/AKfycbz5wMd-rxYdkCGDqAq5cLpCc6ZLubmCo096zG6sib0aTDnHwwzZGh3bvwcz0bOzRe89/exec";

/* ===============================
   LOAD SETTINGS
================================ */
async function loadSettings() {
  const res = await fetch(API_URL + "?type=settings");
  const s = await res.json();

  // Judul & deskripsi
  if (window.siteName && s.nama) siteName.textContent = s.nama;
  if (window.siteDesc && s.deskripsi) siteDesc.textContent = s.deskripsi;

  // Logo
  if (window.logoImg && s.logo_url) logoImg.src = s.logo_url;

  // BACKGROUND WARNA SAJA
  document.body.style.backgroundImage = "none";
  document.body.style.backgroundColor = s.bg_color || "#f4f4f4";

  // WARNA PANEL
  document.querySelectorAll(".sidebar, .data-section, .popup-content")
    .forEach(el => {
      el.style.backgroundColor = s.panel_color || "#ffffff";
    });

  // KONTAK â†’ WHATSAPP
  if (window.whatsappLink && s.kontak) {
    whatsappLink.href = "https://wa.me/" + s.kontak.replace(/\D/g, "");
    whatsappLink.target = "_blank";
  }

  // LOKASI â†’ GOOGLE MAPS
  if (window.mapsLink && s.lokasi) {
    mapsLink.href =
      "https://www.google.com/maps/search/?api=1&query=" +
      encodeURIComponent(s.lokasi);
    mapsLink.target = "_blank";
  }
}

/* ===============================
   DATA BURUNG
================================ */
let birdsCache = [];

async function loadBirds() {
  const res = await fetch(API_URL + "?type=birds");
  birdsCache = await res.json();
  renderBirds(""); // tampilkan semua data awal
}

/* ðŸ” FILTER REALTIME (NO RING / JENIS) */
function renderBirds(keyword) {
  const tbody = birdTable.querySelector("tbody");
  tbody.innerHTML = "";

  const k = keyword.trim().toLowerCase();

  birdsCache.forEach(b => {
    const noRing = (b.no_ring || "").toString().toLowerCase();
    const jenis = (b.jenis || "").toLowerCase();

    if (
      k === "" ||
      noRing.includes(k) ||
      jenis.includes(k)
    ) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${b.no_ring || ""}</td>
        <td>${b.jenis || ""}</td>
      `;
      tr.onclick = () => showPopup(b);
      tbody.appendChild(tr);
    }
  });
}

/* INPUT SEARCH â€“ LANGSUNG FILTER */
if (window.searchInput) {
  searchInput.addEventListener("input", () => {
    renderBirds(searchInput.value);
  });
}

/* ===============================
   POPUP DETAIL
================================ */
function showPopup(b) {
  popupRing.textContent = b.no_ring || "-";
  popupJenis.textContent = b.jenis || "-";
  popupGender.textContent = b.gender || "-";
  popupTgl.textContent = b.tgl_lahir || "-";
  popupJantan.textContent = b.indukan_jantan || "-";
  popupBetina.textContent = b.indukan_betina || "-";
  birdPopup.style.display = "flex";
}

if (window.closePopup) {
  closePopup.onclick = () => {
    birdPopup.style.display = "none";
  };
}

/* ===============================
   INIT (JANGAN DIHAPUS)
================================ */
loadSettings();
loadBirds();
</script>
