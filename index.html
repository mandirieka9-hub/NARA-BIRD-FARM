<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="siteTitle">Penangkaran Burung</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
/* --- TAMPILAN DEFAULT (DESKTOP) --- */
body { font-family: Arial, sans-serif; margin: 0; display: flex; min-height: 100vh; transition: background 0.5s; }
.sidebar { 
    width: 300px; 
    background-color: #2c3e50; 
    color: white; 
    padding: 20px; 
    box-sizing: border-box; 
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}
.sidebar img { max-width: 150px; margin-bottom: 20px; border-radius: 10px; }
.sidebar h1 { font-size: 24px; margin: 0 0 10px 0; }
.sidebar p { margin: 5px 0; font-size: 14px; }
.contact-info { margin-top: 20px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); width: 100%; }

/* Style untuk link Kontak dan Lokasi */
.contact-item {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 10px 0;
    flex-direction: column; 
}
.contact-item a {
    color: white;
    text-decoration: none;
    display: flex;
    align-items: center;
    font-size: 16px;
    transition: color 0.2s;
    margin-bottom: 5px; 
}
.contact-item a:hover {
    color: #1abc9c; 
}
.contact-item i {
    font-size: 24px;
    margin-right: 10px;
}
.location-text {
    font-size: 14px;
    text-decoration: underline;
    text-align: center;
    max-width: 90%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.main-content { flex-grow: 1; padding: 30px; }
.main-content h2 { color: #34495e; border-bottom: 2px solid #ccc; padding-bottom: 5px; }

/* Search Bar */
.search-container { margin-bottom: 20px; }
.search-container input { width: 100%; padding: 10px; box-sizing: border-box; border-radius: 5px; border: 1px solid #ccc; }

/* --- STYLE TABEL ELEGAN --- */
.table-container { 
    overflow-x: auto; 
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}
.bird-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 400px; 
}
.bird-table th {
    background-color: #34495e;
    color: white;
    padding: 12px 15px;
    text-align: left;
    font-weight: 600;
}
.bird-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #ecf0f1;
    cursor: pointer; 
    transition: background-color 0.2s;
    white-space: nowrap;
}
.bird-table tr:hover td {
    background-color: #f5f5f5;
}
.bird-table tr:last-child td {
    border-bottom: none;
}
.ring-cell { font-weight: bold; color: #1abc9c; } 


/* Modal Styles */
.modal {
    display: none; 
    position: fixed; 
    z-index: 1000; 
    left: 0; 
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgba(0,0,0,0.6);
}
.modal-content {
    background-color: #fefefe;
    margin: 15% auto; 
    padding: 20px;
    border: 1px solid #888;
    width: 90%; 
    max-width: 400px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
.modal-content h3 { margin-top: 0; color: #34495e; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
.modal-content strong { display: inline-block; width: 120px; color: #16a085; }
.closeBtn {
    background: #c0392b; 
    color: white; 
    border: none; 
    padding: 10px 15px; 
    margin-top: 20px; 
    border-radius: 5px; 
    cursor: pointer;
}
.closeBtn:hover { background: #e74c3c; }


/* --- MEDIA QUERY UNTUK HP (RESPONSIVE) --- */
@media (max-width: 768px) {
    body { flex-direction: column; }
    .sidebar {
        width: 100%; 
        padding: 10px 20px;
        height: auto;
        flex-direction: row; 
        justify-content: space-between; 
        align-items: center;
        flex-wrap: wrap; 
        border-bottom: 2px solid #16a085;
    }
    .header-content { 
        display: flex; 
        align-items: center; 
        text-align: left;
        width: 100%; 
        margin-bottom: 10px;
    }
    .sidebar img { max-width: 50px; margin: 0 10px 0 0; }
    .sidebar h1 { font-size: 18px; margin: 0; }
    .sidebar p { display: none; } 
    .contact-info { 
        margin-top: 0; 
        padding-top: 0; 
        border-top: none;
        width: 100%; 
        display: flex;
        justify-content: space-around;
        flex-direction: row; 
    }
    .contact-item { flex-direction: row; margin: 5px; } 
    .contact-item a { font-size: 14px; margin-bottom: 0; }
    .contact-item i { font-size: 18px; margin-right: 5px; }
    .main-content { padding: 10px; }
    .location-text { display: none; } 
    .modal-content { margin: 5% auto; }
}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
    <div class="header-content">
        <img id="siteLogo" src="" alt="Logo Penangkaran">
        <h1 id="siteName">Nama Penangkaran</h1>
    </div>
    <p id="siteDesc">Deskripsi singkat tentang penangkaran.</p>
    <div class="contact-info">
        
        <div class="contact-item" id="waContact">
            <p>Memuat Kontak...</p>
        </div>
        
        <div class="contact-item" id="mapsLocation">
            <p>Memuat Lokasi...</p>
        </div>
        
    </div>
</div>

<div class="main-content">
    
    <div class="search-container">
        <input type="text" id="searchInputPublic" oninput="filterBirds()" placeholder="Cari No Ring atau Jenis Burung...">
    </div>
    
    <h2>Data Burung</h2> 
    <div id="birdList" class="table-container">
        <p>Memuat data...</p>
    </div>
</div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">Biodata Burung</h3>
        <div id="modalBody"></div>
        <button class="closeBtn" onclick="document.getElementById('detailModal').style.display='none'">Tutup</button>
    </div>
</div>

<script>
// ***************************************************************
// GANTI DENGAN DETAIL JSONBIN.IO ANDA!
// ***************************************************************
const BIRDS_BIN_ID = "6912191e43b1c97be9a51792"; 
const BIRDS_JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIRDS_BIN_ID}/latest`;
const INFO_BIN_ID = "691219e143b1c97be9a518fe"; 
const INFO_JSONBIN_URL = `https://api.jsonbin.io/v3/b/${INFO_BIN_ID}/latest`;

let birdsCache = [];

// -------------------------------------------------------------
// === FUNGSI MUAT INFO WEBSITE ===
// -------------------------------------------------------------
async function loadSiteInfo(){
    try {
        const response = await fetch(INFO_JSONBIN_URL);
        if (!response.ok) throw new Error('Failed to fetch info.');
        const result = await response.json(); 
        const info = result.record || {}; 
        
        document.getElementById('siteTitle').textContent = info.name || 'Penangkaran Burung';
        document.getElementById('siteName').textContent = info.name || 'Nama Penangkaran';
        document.getElementById('siteDesc').textContent = info.description || 'Deskripsi penangkaran Anda.';
        document.getElementById('siteLogo').src = info.logo || '';
        document.getElementById('sidebar').style.backgroundColor = info.sidebarColor || '#2c3e50';

        // Terapkan Background 
        if (info.bgImageBase64) {
            document.body.style.background = `url(${info.bgImageBase64}) no-repeat center/cover fixed`;
        } else if (info.bgImageUrl) {
            document.body.style.background = `url(${info.bgImageUrl}) no-repeat center/cover fixed`;
        } else {
            document.body.style.background = info.bgColor || '#f5f5f5';
        }

        // --- GENERATE LINK WHATSAPP ---
        const waContactDiv = document.getElementById('waContact');
        let contactNumber = info.contact ? info.contact.replace(/\D/g, '') : ''; 
        if (contactNumber.startsWith('0')) {
            contactNumber = '62' + contactNumber.substring(1);
        } else if (!contactNumber.startsWith('62') && contactNumber.length > 5) {
            contactNumber = '62' + contactNumber;
        }
        const whatsappLink = `https://wa.me/${contactNumber}`;
        waContactDiv.innerHTML = `
            <a href="${whatsappLink}" target="_blank">
                <i class="fab fa-whatsapp"></i> WhatsApp
            </a>
        `;

        // --- GENERATE LINK GOOGLE MAPS ---
        const mapsLocationDiv = document.getElementById('mapsLocation');
        const locationText = info.location || 'Lokasi Belum Diisi';
        const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(locationText)}`;
        
        mapsLocationDiv.innerHTML = `
            <a href="${mapsUrl}" target="_blank">
                <i class="fas fa-map-marker-alt"></i> Buka Maps
            </a>
            <p class="location-text" title="${locationText}">${locationText}</p>
        `;

    } catch (error) {
        console.error("Error loading site info:", error);
    }
}

// -------------------------------------------------------------
// === FUNGSI MUAT & RENDER DATA BURUNG ===
// -------------------------------------------------------------
async function loadBirdsData(){
    const birdListDiv = document.getElementById('birdList');
    birdListDiv.innerHTML = '<p>Memuat data burung...</p>';
    
    try {
        const response = await fetch(BIRDS_JSONBIN_URL);
        if (!response.ok) throw new Error('Failed to fetch bird data.');
        const result = await response.json(); 
        birdsCache = result.record || []; 
        
        renderBirdList();
        
    } catch (error) {
        console.error("Error fetching bird data:", error);
        birdListDiv.innerHTML = '<p style="color: red;">Gagal memuat data burung. Pastikan BIN ID benar dan statusnya PUBLIC.</p>';
    }
}

function renderBirdList(filterQuery = ''){
    const tableContainer = document.getElementById('birdList');
    const query = filterQuery.toLowerCase();

    const filteredBirds = birdsCache.filter(b => {
        return b.noRing.toLowerCase().includes(query) || 
               b.jenis.toLowerCase().includes(query);
    });

    if (filteredBirds.length === 0) {
        tableContainer.innerHTML = `<p>Tidak ada ${query ? 'data burung yang cocok' : 'data burung yang tersedia'} saat ini.</p>`;
        return;
    }

    let tableHTML = `
        <table class="bird-table">
            <thead>
                <tr>
                    <th>No Ring</th>
                    <th>Jenis Burung</th>
                </tr>
            </thead>
            <tbody>
    `;

    filteredBirds.forEach((b) => {
        // Baris tabel yang bisa diklik
        tableHTML += `
            <tr onclick="openBirdDetails('${b.noRing}')">
                <td class="ring-cell">${b.noRing}</td>
                <td>${b.jenis}</td>
            </tr>
        `;
    });

    tableHTML += `
            </tbody>
        </table>
    `;

    tableContainer.innerHTML = tableHTML;
}

function filterBirds() {
    const query = document.getElementById('searchInputPublic').value.trim();
    renderBirdList(query);
}

function openBirdDetails(noRing){
    const bird = birdsCache.find(b => b.noRing === noRing);

    if (!bird) return;

    const modalBody = document.getElementById('modalBody');
    document.getElementById('modalTitle').textContent = `Detail Burung (${bird.noRing})`;
    
    modalBody.innerHTML = `
        <p><strong>Jenis Burung:</strong> ${bird.jenis}</p>
        <p><strong>Jenis Kelamin:</strong> ${bird.jenisKelamin}</p>
        <p><strong>Tgl Lahir:</strong> ${bird.tglLahir}</p>
        <p><strong>Indukan Jantan:</strong> ${bird.indukanJ || '-'}</p>
        <p><strong>Indukan Betina:</strong> ${bird.indukanB || '-'}</p>
    `;

    document.getElementById('detailModal').style.display = 'block';
}


// Panggil fungsi saat halaman dimuat
loadSiteInfo();
loadBirdsData();
</script>
</body>
</html>